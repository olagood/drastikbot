<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Drastikbot :: Module Development</title>
    <link type="text/css" rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div id="logo"></div>
    <div id="menu">
      <ul>
        <li> [ </li>
	    <li><a href="index.html">drastikbot</a></li>
        <li> ] </li>
        <li> [ </li>
	    <li><a href="quickguide.html">Quick Guide</a></li>
        <li> ] </li>
        <li> [ </li>
	    <li><a href="modules.html">Module Documentation</a></li>
        <li> ] </li>
        <li> [ </li>
	    <li><a href="https://github.com/olagood/drastikbot">GitHub</a></li>
	    <li> ] </li>
	    <li><a href="http://drastik.org">drastik.org</a></li>
      </ul>
    </div>
    <div id="newsbox" style="width:85%;">
      <ul>
	    <li>
	      <h2>Developing Modules for drastikbot</h2>
        </li>
      </ul>
    </div>
    <div id="docmenu">
      <ul>
        <li><a href="#helloworld">Hello, World!</a></li>
        <li><a href="#module">Module() class</a></li>
        <li><a href="#irc">irc.py</a></li>
        <li><a href="#msg">Messages</a></li>
        <li><a href="#vars">Persistent Variables</a></li>
        <li><a href="#db">Databases</a></li>
        <li><a href="#nickserv_auth">Authenticating with NickServ</a></li>
        <li><a href="#p_truncate">Text truncation</a></li>
        <li><a href="#config">Using the configuration file</a></li>
        <li><a href="#about">About modules</a></li>
      </ul>
    </div>
    <div id="newsbox" style="width: 85%;">
      <ul>
        <li id="helloworld">
          <h3>Hello, World!</h3>
          <p>Example of a helloworld.py module</p>
          <div class="code"><pre><code>
 # Hello, World! Module for Drastikbot
 #
 # This module sends 'Hello, World!' to the channel when
 # the command .hello is issued.


 class Module:
     def __init__(self):
         self.commands = ['hello']


 def main(i, irc):        
     if i.msg_nocmd == '':
         irc.privmsg(i.channel, 'Hello, World!')
          </code></pre></div>
          
          <br>
          <p>Next, I will explain line by line what is going on.</p>
          <div class="code"><pre><code>
 # Hello, World! Module for Drastikbot
 #
 # This module sends 'Hello, World!' to the channel when
 # the command .hello is issued.
          </code></pre></div>
          <p>Modules should have a comment on top. This comment should contain a
            description of what the module does, a list of all third party
            dependencies and basic instructions on how to install them.</p>
          <div class="code"><pre><code>
 class Module:
     def __init__(self):
         self.commands = ['hello']
          </code></pre></div>
          <p>The Module() class is called when the module is imported for the
            first time to let drastikbot know what options the module uses. We
            will see what these options are in the next section.</p>
          <div class="code"><pre><code>
 def main(i, irc):        
     if i.msg_nocmd == '':
         irc.privmsg(i.channel, 'Hello, World!')
          </code></pre></div>
          <p>The main() function is called by the bot, when one of the criteria
            set in the Module() class are met, to activate the module.</p>
          <p>The main() function takes two arguments. The first argument "i"
            points to a class that contains the message, the sender, runtime
            functions and many other things that will be explained in detail
            in the section <a href="#msg">Messages</a>.</p>
          <p>The second argument "irc" gives access to various runtime variables
            and functions responsive for communicating with the IRC server.</p>
          <p>The variable "i.msg_nocmd" is used for getting user input without
            the command itself. We check to see if it was empty and if that was
            the case we call the irc.privmsg() method.</p>
          <p>This method takes two strings as arguments. The first one can
            either be the nickname of a user or the name of a channel. The
            second one is the message we want to send. The i.channel variable
            will give you the channel the command was posted in or the nickname
            of the user that issued the command if that command was sent in a
            query with the bot.</p>
        </li>


        <li id="module">
          <h3>The Module() class</h3>
          <p>As explained above, the Module() class is called when drastikbot
            imports its modules during startup. Using the administration
            command: '.mod_import' you can force reload the Module() classes of
            the loaded modules and import new modules added in the configuration
            file.</p>
          <p>In the <b>__init__</b> method we can add the following options: 
          <div class="code"><pre><code>
 class Module:
     def __init__(self):
         self.commands = ['command1', 'command2']
         self.auto = True
         self.msgtype = ['NOTICE', 'PRIVMSG']
         self.helpmsg = ['This is the Module() class where we set out options.']
          </code></pre></div>
          <p style="text-align: left;"><b>self.commands</b>
            : This is a list of the commands the bot should call this module
            for. If two or more modules have the same commands the bot will exit
            and an error message will be returned.
            <b>The commands are case sensitive.</b></p>
          <p style="text-align: left;"><b>self.auto</b>
            : Setting this option to True will make the bot call this module on
            <b>every</b> message sent by the server (as long as the "msgtype"
            matches, see below).</p>
          <p style="text-align: left;"><b>self.msgtype</b>
            : Message types refer to the IRC commands sent by the server. Such
            commands are PRIVMSG, NOTICE, JOIN etc. This option takes a list of
            such commands and the bot will only call the modules based on this
            list. You may not use this option at all if all you need is PRIVMSG
            (normal IRC messages) as this is the default message type used when
            this option is unset.</p>
          <p style="text-align: left;"><b>self.helpmsg</b>
            : This is not a built in option but an extension added by the
            help.py module (found in the drastikbot_modules repository). It
            takes a list of strings and outputs them when the command .help
            [module name] is given to the bot provided that help.py is loaded.
            Do not use this option if you don't want help.py to list your
            module. If you do want to be listed, then a help message must be
            added. Read the top comment on the help.py source file to learn
            more</p>
        </li>

        
        <li id="irc">
          <h3>irc.py</h3>
          <p>The irc.py file contains runtime variables and methods to interact
            with the IRC server. It can be accessed through the second argument
            of the main() function.</p>
          <p>Variables are split in two categories. Runtime variables that are
            updated automatically and Configuration variables that are values
            from the configuration file and are reloaded only after
            irc.config_load() is called.</p>

          <br><b>Runtime Variables</b>
          <table>
            <tr>
              <td class="td_var">irc.var.cd</td>
              <td class="td_str">: str</td>
              <td>This variable contains the bot's configuration directory</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.proj_path</td>
              <td class="td_str">: str</td>
              <td>This is the directory where the boot was installed</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.version</td>
              <td class="td_str">: str</td>
              <td>Current version string of the bot</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.reconnect_delay</td>
              <td class="td_num">: int / float</td>
              <td>The delay for the next reconnection attempt</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.msg_len</td>
              <td class="td_num">: int</td>
              <td>The maximum amount of characters a single IRC message can
                have. This already includes the bot's nickname and hostmask,
                more details on this in the "Text truncation" section</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.curr_nickname</td>
              <td class="td_str">: str</td>
              <td>The bot's currently used nickname</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.bot_hostmask</td>
              <td class="td_str">: str</td>
              <td>The bot's hostmask as given by the server</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.alt_nickname</td>
              <td class="td_bool">: bool</td>
              <td>Whether or not a different nickname than the one in the
                configuration file is being used</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.connected_ip</td>
              <td class="td_str">: str</td>
              <td>The IP address of the server the bot is connected to.
                <br>(!) This value might be an empty string.</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.connected_host</td>
              <td class="td_str">: str</td>
              <td>The hostmask of the server the bot is connected to
              <br>(!) This value might be an empty string.</td></td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ircv3_ver</td>
              <td class="td_str">: str</td>
              <td>The IRCv3 version the bot requested during the CAP negotiation</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ircv3_cap_req</td>
              <td class="td_str">: str : tuple</td>
              <td>The IRCv3 capabilities the bot requested from the server</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ircv3_serv</td>
              <td class="td_bool">: bool</td>
              <td>Whether or not the server supports IRCv3</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ircv3_cap_ls</td>
              <td class="td_str">: str : list</td>
              <td>List of the IRCv3 capabilities the server supports</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ircv3_cap_ack</td>
              <td class="td_str">: str : list</td>
              <td>List of the IRCv3 capabilities acknowledged with the server</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.sasl_state</td>
              <td class="td_num">: int</td>
              <td>The state of the SASL registration.<br>
                <b>0</b>: Not tried |
                <b>1</b>: Success |
                <b>2</b>: Fail |
                <b>3</b>: In progress</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.conn_state</td>
              <td class="td_num">: int</td>
              <td>The state of the connection with the IRC server.<br>
                <b>0</b>: Disconnected |
                <b>1</b>: Registering |
                <b>2</b>: Connected</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.namesdict</td>
              <td class="td_dict">: dict</td>
              <td>
                <b>{"#channel1": [ ["=","S"], {"nick1": ["@"], ...} ], ...}</b><br>
                It contains the channels the bot is connected to, the channel
                modes and the joined users with their modes.</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.botmodes</td>
              <td class="td_str">: str : list</td>
              <td>The modes given to the bot by the IRC server.<br>
                (!) If you want to use the bot's modes from a channel use
                <b>irc.namesdict</b></td>
            </tr>
          </table>

          <br><br><b>Configuration Variables</b>
          <table>
            <tr>
              <td class="td_var">irc.var.owners</td>
              <td class="td_str">: str : list</td>
              <td>The IRC nicknames of the bot's owners</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.host</td>
              <td class="td_str">: str</td>
              <td>The hostname of the IRC server</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.port</td>
              <td class="td_num">: int</td>
              <td>The port of the IRC server</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.ssl</td>
              <td class="td_bool">: bool</td>
              <td>Whether or not SSL is used</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.nickname</td>
              <td class="td_str">: str</td>
              <td>The nickname of the bot</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.username</td>
              <td class="td_str">: str</td>
              <td>The username of the bot</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.realname</td>
              <td class="td_str">: str</td>
              <td>The realname of the bot</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.authentication</td>
              <td class="td_str">: str</td>
              <td>The authentication method used
                <br><b>sasl</b> or <b>nickserv</b></td>
            </tr>
            <tr>
              <td class="td_var">irc.var.auth_password</td>
              <td class="td_str">: str</td>
              <td>The authentication password</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.net_password</td>
              <td class="td_str">: str</td>
              <td>The IRC server password to use</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.quitmsg</td>
              <td class="td_str">: str</td>
              <td>The default message the bot should use when
                <b>irc.quit()</b> is called</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.msg_delay</td>
              <td class="td_num">: int / float</td>
              <td>The delay between each message in multipart messages.
                <br>Multipart messages are messages that don't fit in a single
                IRC message (512 characters) so the bot will split them and
                send them sequentially. We need this delay to avoid having the
                IRC server close the connection for "Post Flooding"</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.channels</td>
              <td class="td_dict">: dict</td>
              <td><b>{"#channel": ""}</b>
                <br>A dictionary of channels with their passwords. An empty
                string means that there is no password used</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.modules_obj</td>
              <td class="td_dict">: dict</td>
              <td>A shortcut to the <b>modules</b> block of the configuration
                file. See the configuration file for available keys and values.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.var.modules_load</td>
              <td class="td_str">: str : list</td>
              <td>The names of the modules the bot is set to load at startup
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.var.mod_glb_prefix</td>
              <td class="td_str">: str</td>
              <td>The default prefix used for commands. This is the character
                used before a command name
                <br>E.g.: <b>.command</b>  '<b>.</b>' is the prefix here</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.mod_chn_prefix</td>
              <td class="td_str">: str</td>
              <td><b>{"#channel": "cmd_prefix"}</b>
                <br>Set the default prefix used for commands in a specific
                channel</td>
            </tr>
            <tr>
              <td class="td_var">irc.var.user_acl</td>
              <td class="td_str">: str : tuple</td>
              <td>A list of rules used to filter users based on their nickname,
                username and hostname</td>
            </tr>
          </table>
          <p>You can also access the configuration file directly using the
            configuration tools provided by the bot. This will be discussed in
            the <a href="#config">Using the Configuration File</a> section.</p>

          <br><br><b>Methods</b>
          <table>
            <tr>
              <td class="td_var">irc.send(<i>cmds, text=None</i>)</td>
              <td>The main sending method. This is used to construct commands
                which are not already available by irc.py. All output to the IRC
                server is sent with this method
                <br><br><b>cmds</b> : is a tuple of strings (single words) that
                contains all the commands of the message. In the IRC spec this
                is referred to as COMMANDS.
                <br><b>text</b> : should be a string with the text needed for an
                IRC command. In the IRC spac this is the PARAMS part.
                <br><br>The message is constructed as <b>COMMANDS :PARAMS</b>
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.privmsg(<i>target, msg</i>)</td>
              <td>Send a PRIVMSG. This is used to post to channels and users
                <br><br><b>target</b> : is the reciever and can be a channel or
                a nickname.
                <br><b>msg</b> : is the message to send.
            </tr>
            <tr>
              <td class="td_var">irc.notice(<i>target, msg</i>)</td>
              <td>Send a NOTICE. This is used to send a notice to channels and
                people.
                <br><br><b>target</b> : is the reciever and can be a channel or
                a nickname.
                <br><b>msg</b> : is the message to send""</td>
            </tr>
            <tr>
              <td class="td_var">irc.join(<i>chanDict</i>)</td>
              <td>JOIN one or more IRC channels.
                <br><br><b>chanDict</b> : must be dictionary with each channel as
                a key and it's password as a value: <b>{"#channel": ""}</b></td>
            </tr>
            <tr>
              <td class="td_var">irc.part(<i>channel, msg</i>)</td>
              <td>
                PART (leave) from a joined channel.
                <br><br><b>channel</b> : is the channel to part.
                <br><b>msg</b> : is the part message to send.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.invite(<i>nick, channel</i>)</td>
              <td>
                INVITE a user to join a channel.
                <br><br><b>nick</b> : is the nickname of the user.
                <br><b>channel</b> : is the channel you want to invite the user
                to.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.kick(<i>channel, nick, msg</i>)</td>
              <td>
                KICK a user from a channel. The bot must have Operator
                privilages.
                <br><br><b>channel</b> : is the channel you want to kick the
                user from.
                <br><b>nick</b> : is thenickname of the user you want to kick.
                <br><b>msg</b> : is the message you want to send with the kick.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.nick(<i>nick</i>)</td>
              <td>
                Change the bot's nickname. This does not set the
                irc.curr_nickname variable. You will have to set it yourself
                (preferably after making sure that the bot actually got that nickname).
                <br><br><b>nick</b> : is the new nickname.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.quit(<i>msg=''</i>)</td>
              <td>
                QUIT from the IRC server. This will result in the bot shutting
                down.
                <br><br><b>msg</b> : is the message you want to send with the
                quit command. If left blank the bot will use the default quit
                message or the quit message set in the configuration file.
              </td>
            </tr>
            <tr>
              <td class="td_var">irc.away(<i>msg=''</i>)</td>
              <td>
                Set the bot as being AWAY.
                <br><br><b>msg</b> : is the message you want your users to see
                when they highlight the bot.
              </td>
            </tr>
          </table>
        </li>

        <li id="msg">
          <h3>Messages and internal functions</h3>
          <p>As you saw earlier the <b>main()</b> function takes two arguments.
            The second argument <b>irc</b> was explained in the previous
            section. The first arguement <b>i</b> will be explained here.</p>
          <p>This argument gives you access to various variables about the
            current message and lots of internal methods. More specifically:</p>
          <br><b>Variables</b>
          <table>
            <tr>
              <td class="td_var">i.cmd</td>
              <td class="td_str">: str</td>
              <td>This is the command that this module was called from (without
                the command prefix). Using this you can take different actions
                if your module is using many different commands. If the module
                was called because of the <b>self.auto = True</b> option then
                <b>i.cmd</b> will be an empty string</td>
            </tr>
            <tr>
              <td class="td_var">i.channel</td>
              <td class="td_str">: str</td> 
              <td>This is the channel from which the module was called. This is
                where you usually want to reply to. If the module was called
                from a private message with a user, this will be that user's
                nickname</td>
            </tr>
            <tr>
              <td class="td_var">i.nickname</td>
              <td class="td_str">: str</td> 
              <td>This is the nickname of the user that triggered the module
                call</td>
            </tr>
            <tr>
              <td class="td_var">i.username</td>
              <td class="td_str">: str</td> 
              <td>This is the username of the user that triggered the module
                call</td>
            </tr>
            <tr>
              <td class="td_var">i.hostname</td>
              <td class="td_str">: str</td> 
              <td>This is the hostname of the user that triggered the module
                call</td>
            </tr>
            <tr>
              <td class="td_var">i.msg_raw</td>
              <td class="td_str">: bytes</td> 
              <td>The full undecoded message as sent by the server</td>
            </tr>
            <tr>
              <td class="td_var">i.msg_full</td>
              <td class="td_str">: str</td> 
              <td>The full decoded message as sent by the server</td>
            </tr>
            <tr>
              <td class="td_var">i.msg</td>
              <td class="td_str">: str</td> 
              <td>The message the user sent to the channel or the bot. In IRC's
                terminology this is called PARAMS</td>
            </tr>
            <tr>
              <td class="td_var">i.msg_prefix</td>
              <td class="td_str">: str</td> 
              <td>Alias for "i.msg" that matches the IRC terminology</td>
            </tr>
            <tr>
              <td class="td_var">i.msg_nocmd</td>
              <td class="td_str">: str</td> 
              <td>The message the user sent to the channel or the bot, but with
                the bot's command removed
                <br>E.g. Alice: .seen Bob
                <br>i.msg_nocmd will be: "Bob"
              </td>
            </tr>
            <tr>
              <td class="td_var">i.msg_ls</td>
              <td class="td_str">: str : list</td> 
              <td>The full message decoded as a list</td>
            </tr>
            <tr>
              <td class="td_var">i.msg_prefix</td>
              <td class="td_str">: str</td> 
              <td>The prefix of the IRC message. This is the user's nickname
                with their hostmask.<br>
                E.g. drastik!drastik@hostmask
              </td>
            </tr>
            <tr>
              <td class="td_var">i.cmd_ls</td>
              <td class="td_str">: str : list</td> 
              <td>This is a list of the COMMANDS part of the IRC message (PARAMS
                are removed). Using "i.msg_ls" is usually preferable</td>
            </tr>
            <tr>
              <td class="td_var">i.cmd_prefix</td>
              <td class="td_str">: str</td> 
              <td>This is the prefix of the bot command the user gave. This
                depends on how the bot has been configured. E.g. "."</td>
            </tr>
            <tr>
              <td class="td_var">i.msgtype</td>
              <td class="td_str">: str</td> 
              <td>This is the message type that this module was called from.
                Using this you can take different actions if your module is
                using many different message types
              </td>
            </tr>
            <tr>
              <td class="td_var">i.db</td>
              <td class="td_bool">: object : list</td>
              <td><b>[dbmem, dbdisk]</b><br>
                A list with the available SQLite databases.
                <br><br><b>dbmem</b> - <b>index: 0</b > - is the database stored
                in memory and its data is lost when the bot shuts down.
                <br><b>dbdisk</b> - <b>index: 1</b> - is the databased store in
                the disk (the database itself is called <b>drastikbot.db</b> and
                is saved in the bot's configuration directory) and is
                non-volatile.
                <br><br>More details about the usage of the databases can be
                found in the <a href="#db">Databases</a> section
              </td>
            </tr>
            <tr>
              <td class="td_var">i.modules</td>
              <td class="td_dict">: dict</td>
              <td><b>{"Module Name" : Module Callable}</b><br>
                This gives access to a dictionary that contains the names of all
                loaded modules as keys and their callables as values.
              </td>
            </tr>
            <tr>
              <td class="td_var">i.command_dict</td>
              <td class="td_dict">: dict</td>
              <td><b>{"command1": "module"}</b><br>
                This dictionary has every command as a key and the name of its
                matching module as a value.
              </td>
            </tr>
            <tr>
              <td class="td_var">i.auto_list</td>
              <td class="td_str">: str : list</td>
              <td><b>["module1", ...]</b><br>
                List of all the modules that are automatically called on every
                message (a.k.a. modules with the <b>self.auto = True</b> option)
              </td>
            </tr>
          </table>
          
          <br><br><b>Methods</b>
          <table>
            <tr>
              <td class="td_var">i.varset(<i>name, value</i>)</td>
              <td>Method used to set a variable that is kept in the bot's
                memory. See <a href="#vars">Persistent Variables</a> for
                details.
                <br><br><b>name</b> : is the name of the variable.
                <br><b>value</b> : is the variable's value.
              </td>
            </tr>
            <tr>
              <td class="td_var">i.varget(<i>name, defval=False, raw=False</i>)
              </td>
              <td>Method used to get a variable from the bot's memory.
                See <a href="#vars">Persistent Variables</a> for details.
                <br><br><b>name</b> : is the name of the variable.
                <br><b>defval</b> : is the default to <b>set</b> if no variable
                is found.
                <br><b>raw</b> : if True the method will not append the module's
                name in frond of <b>name</b>.
                This is used to access variables from other modules.
                <br><br>If both <b>defval</b> and <b>raw</b> are non False but
                    the variable cannon be found an AttributeError is raised.
              </td>
            </tr>
            <tr>
              <td class="td_var">i.blacklist(<i>module, channel</i>)</td>
              <td>Read the configuration file and check if the channel is in the
                blacklist of the given module. It will return True if the
                channel is in the blacklist or False if it is not or if the
                blacklist is empty.
                <br><br><b>module</b> : The name of the module module
                <br><b>channel</b> : The name of the channel
              </td>
            </tr>
            <tr>
              <td class="td_var">i.whitelist(module, channel)</td>
              <td>Read the configuration file and check if the channel is in the
                blacklist of the given module. It will return True if the
                channel is in the module's whitelist or if the whitelist is
                empty and False if the whitelist is not empty and the channel is
                not in it.
                <br><br><b>module</b> : The module that will be checked if it's
                whitelisted.
                <br><b>channel</b> : The channel that will be checked for having
                the given whitelisted module
              </td>
            </tr>
            <tr>
              <td class="td_var">i.mod_import()</td>
              <td>
                Method used to import the modules specified in the configuration
                file. Checks for values specified in the <b>Module()</b> class
                of every module and sets the internal variables for later use.
              </td>
            </tr>
          </table>
        </li>

        
        <li id="vars">
          <h3>Persistent Variables</h3>
          <p>Modules in drastikbot are stateless. This means that after a module
            finishes it's execution all the objects it created will be lost.
            Further calls of this module will not be able to access the data
            saved in previous calls.</p>
          <p>To circumvent this restriction drastikbot provides you with the
            <b>i.varset()</b> and <b>i.varget()</b> methods. These methods are
            part of the <b>VariableMemory()</b> class which is part of
            drastikbot's runtime and as such its data will cannot be lost unless
            the bot's exeuction is terminated.</p>
          <br><h4 style="text-align: left;">i.varset(<i>name, value</i>)</h4>
          <p style="text-align: left;">
            <b>name</b> : is the name of the variable.
            <br><b>value</b> : is the variable's value.</p>
          <p>The method works by getting the <b>name</b> of the variable,
            adding the module's name infrond of it and creating a class variable
            (so the actual variable name is:
            <b>[caller_module_name]_["name"]</b>). This way we avoid
            conflicting variable names between modules. </p>
          <br><h4 style="text-align: left;">
            i.varget(<i>name, defval=False, raw=False</i>)</h4>
          <p>With this method we can retrieve the value of a variable previously
            set by <b>i.varset()</b> or set a default variable. The arguements
            it can take are three but only <b>name</b> is mandatory.</p>
          <p style="text-align: left;">
            <b>name</b> : is the name of the variable.
            <br><b>defval</b> : is the default to <b>set</b> if no variable is
            already set.
            <br><b>raw</b> : if True the method will not append the module's
            name in frond of <b>name</b>.</p>
          <p>If <b>defval</b> is given then the method will set and return the
            value given if the variable has not been set.</p>
          <p>If you set <b>raw</b> it to True then the <b>name</b> you pass will
            not be translated to the <b>[caller_module_name]_["name"]</b> format
            shown above. This allows you to access the variables of other
            modules by constructing that format above yourself and choosing the
            name of the module you want.</p>
          <p>If you set both <b>defval</b> and <b>raw</b>, but getting the
            remote variable fails, then there will be an AttributeError raised,
            because writing to the variables of other modules is not allowed.
          </p>
        </li>


        <li id="db">
          <h3>Databases</h3>
          <p>Drastikbot provides two SQLite3 databases for the modules to write and read
            data from. One database is saved on the disk, while the other stays in memory
            and isn't preserved after a shut down.</p>
          <p>Modules creating new tables should use their name as a prefix to the table's
            name so that conflics will be avoided. Example: module1_table</p>
          <p style="text-align: left;">
            <br><b>i.db[0]</b> : gives you access to the memory database
            function (saved in RAM).
            <br><b>i.db[1]</b> : gives access to the database saved in the disk
            as <b>drastikbot.db</b> (in the root of the config directory).</p>
          <p>You can read python's guide on SQLite3 if you aren't familiar with it here:
            <a href="https://docs.python.org/3/library/sqlite3.html">
              https://docs.python.org/3/library/sqlite3.html</a>.</p>
          <p>If you want to see examples of drastikbot modules using the SQLite3 database
            check out the <a href="https://github.com/olagood/drastikbot_modules">
              drastikbot_modules repository</a>.</p>
        </li>


        <li id="nickserv_auth">
          <h3>Authenticating Users with NickServ</h3>
          <p>Drastikbot provides a function to check if a user is identified
            with NickServ. This can be useful when you want to verify a user's
            identity. This function only works in servers where NickServ
            supports the ACC and STATUS commands.</p>
          <p style="text-align: left;">
            In order to use that function you first need to import the user_auth
            module:</p>
          <div class="code"><pre><code>
 from user_auth import user_auth
          </code></pre></div>
          <p style="text-align: left;">
            Then to check a user's authentication status call the function:
            <br><br><b>user_auth(i, irc, irc_nick, timeout=10)</b>
            <br><br><b>i</b> : is the first argument passed to <b>main()</b>
            <br><b>irc</b> : is the second argument passed to <b>main()</b>
            <br><b>irc_nick</b> : is the nickname of the user you want to check
            <br><b>timeout=10</b> : is the amount of time the function should
            wait for a response from NickServ.<p>
          <p style="text-align: left;">The function returns:
          <br><b>True</b> : if a user is sucessfully identified with NickServ.
          <br><b>False</b> : if the user is not identified or the timeout was
          reached.</p>
          <p>Example:</p>
          <div class="code"><pre><code>
if not user_auth(i, irc, irc_nick):
    return f'{irc_nick}: You are not logged in with NickServ.'
          </code></pre></div>
        </li>

        
        <li id="p_truncate">
          <h3>Text truncation</h3>
          <p>IRC messages are limited to 512 bytes. This includes not only the text you want to send
            but also your nickname and your IRC commands.<p>
          <p>Drastikbot does not limit the amount of text a module can output and will send
            additional messages until all output from a module is sent to the IRC server. This is
            not always preferable and you may want to limit the output of your module. For this
            purpose drastikbot provides you with a mechanism and a variable that will help you
            properly manage the output of your module.</p>
          <p style="text-align: left;">First of all, let's have a look at the "irc.msg_len"
            variable. It contains the amount of bytes the output of the module should be to avoid
            sending additional messages. The value will always be less than 512 characters as the
            length of the bot's nickname and hostname are substracted.</p>
          <p>Next we have the p_truncate() function that is included in the dbot_tools module.</p>
          <div class="code"><pre><code>
from dbot_tools import p_truncate

p_truncate(text, whole, percent, ellipsis=False)                
          </code></pre></div>
          <p style="text-align: left;">
            <br><b>"text"</b> is the text that will be truncated. It must be a string.
            <br><b>"whole"</b> is the maximum amount of characters the message can have. This can
            be "irc.msg_len", but you usually have to substract from "irc.msg_len" the commands
            (substract 9 chars if you are sending a "PRIVMSG :") and any special formatting you do.
            Remember that this is bytes so if you are using unicode make sure to encode it first.
            <br><b>"percent"</b>This is an integer. It's the percent of the whole you want to
            allocate for the truncation. This is useful if you have multiple sources of text you
            want to truncate.
            <br><b>"ellipsis=False"</b> If it's True then the function will add "..." at the end of
            the text, but only if it's truncated.</p>
          <p>Using p_truncate() is preferable for text truncating as it will take care to not break
            unicode strings during truncation.</p>
        </li>

        
        <li id="config">
          <h3>Using the Configuration File</h3>
          <p>Drastikbot's settings are loaded from it's configuration file
            <b>config.json</b>, which is located at the root of the
            configuration directory. All the modules that need to have settings
            saved could make use of this config file, but preferably something
            else should be used.</p>
          <p>Modules using <b>config.json</b> should take great care of not
            overwriting the bot's values.
            <br>It is recommended to save any settings in the dictionary:
            <br><b>irc: {modules: { settings: { module_name: {}}}}</b>
          </p>
          <pre class="code"><code>
 { "irc": {
       "modules": {
           "settings": {
               "module_name": {
                   "setting1": "value1"
                   }
               }
           }
       }
  }
          </pre></code>
          <br><h4 style="text-align: left;">Using the Config() class</h4>
          <p>Drastikbot provides dbot_tools.Config(), a small class containing a
            read and a write method that can be used to interact with the
            configuration file. Alternatively one could just import Python's
            JSON module and make their own functions.</p>
          <p>To use these methods in your module, first import the Config()
            class:</p>
          <pre class="code"><code>
from dbot_tools import Config              
          </code></pre>
          <p>
            The Config() class takes the configuration directory as an argument.
            You can get the configuration directory from the irc.py library,
            which can be accessed with the second argument of the main()
            function.</p>
          <pre class="code"><code>
config = Config(irc.cd)
          </code></pre>
          <p>To read a value you call the read method</p>
          <pre class="code"><code>
owners = config.read()['irc']['owners']
          </code></pre>
          <p>To write to the configuration file, you need to load it in a
            variable using read(), edit that variable as needed and then save it
            back with write().
            <br>It is important to have the whole configuration
            in the variable passed to write().</p>
          <pre class="code"><code class="python">
config = Config(irc.cd)
config_file = config.read()
config_file['irc']['owner'] = "not_drastik"
config.write(config_file)
          </code></pre>
        </li>

        
        <li id="about">
          <h3>About modules</h3>
          <p>Drastikbot automatically reloads modules every time they are
            called. This allows you to edit the modules, add new features to
            them and fix bugs without restarting the bot or manually reloading
            it's modules. However, keep in mind that the Module() class isn't
            being automatically reloaded.</p>
          <p>Drastikbot is multi-threaded. Each module call runs the modules in
            a new thread allowing for multiple modules to run concurently and
            perform long background tasks without blocking the bot. This is also
            the reason why variables are not persistent and the modules are
            stateless.</p>
          <p>The drastikbot_modules repository and package can serve as a
            kitchen sink for the bot's module functionality. Refer to it for
            examples on how to write modules for drastikbot.</p>
          <p>For questions and help with module development contact
            <b>drastik</b> at <b>Freenode</b> or <b>Rizon</b>.</p>
        </li>
      </ul>
    </div>
  </body>
</html> 
